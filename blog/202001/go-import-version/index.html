<!DOCTYPE html>
<html lang="en-us">
<head><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="程序员">
    
    <meta name="keyword"  content="程序员,Golang,Microservice">
    <link rel="shortcut icon" href="https://silenceper.com/img/favicon.ico">

    <title>如何在Go项目中输出版本信息？- silenceper的博客</title>

    <link rel="canonical" href="https://silenceper.com/blog/202001/go-import-version/">

    <link rel="stylesheet" href="https://silenceper.com/css/iDisqus.min.css"/>

    
    <link rel="stylesheet" href="https://silenceper.com/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="https://silenceper.com/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="https://silenceper.com/css/syntax.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <script src="https://silenceper.com/js/jquery.min.js"></script>

    
    <script src="https://silenceper.com/js/bootstrap.min.js"></script>

    
    <script src="https://silenceper.com/js/hux-blog.min.js"></script>
</head>
</head>

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://silenceper.com/">silenceper</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="https://silenceper.com/">Home</a>
                    </li>
                    
                    <li>
                        <a href="https://silenceper.com/categories/tech">tech</a>
                    </li>
                    

                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header{
        background-image: url('https://silenceper.com/img/bg/qiao.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                       
                       <a class="tag" href="/tags/go" title="go">
                           go
                        </a>
                        
                    </div>
                    <h1>如何在Go项目中输出版本信息？</h1>
                    <h2 class="subheading">这篇文章主要描述如何在构建Go项目的时候通过ldflags参数对变量进行动态赋值</h2>
                    <span  class="meta">Posted by silenceper on Friday, January 10, 2020
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

		
                <header>
                <h2>TOC</h2>
                </header>
                <nav id="TableOfContents">
<ul>
<li><a href="#实现">实现</a></li>
<li><a href="#参数说明">参数说明</a></li>
<li><a href="#一个完整的例子">一个完整的例子</a></li>
</ul>
</nav>
		
		

<p>我们经常在使用CLI工具的时候，都会有这样的参数输出：</p>

<pre><code>➜  ~ docker version
Client: Docker Engine - Community
 Version:           18.09.2
 API version:       1.39
 Go version:        go1.10.8
 Git commit:        6247962
 Built:             Sun Feb 10 04:12:39 2019
 OS/Arch:           darwin/amd64
 Experimental:      false
➜  ~
</code></pre>

<p>可以打印出构建时对应的版本信息，比如 Version，Go Version，Git Commit等，这个是如何实现的呢？</p>

<h1 id="实现">实现</h1>

<p>主要是通过<code>ldflags</code>参数来实现在构建的时候对变量进行赋值。</p>

<p>比如下面一段代码：</p>

<pre><code>package main

import (
	&quot;flag&quot;
	&quot;fmt&quot;
	&quot;os&quot;
)

//需要赋值的变量
var version = &quot;&quot;

//通过flag包设置-version参数
var printVersion bool

func init() {
	flag.BoolVar(&amp;printVersion, &quot;version&quot;, false, &quot;print program build version&quot;)
	flag.Parse()
}

func main() {
	if printVersion {
		println(version)
		os.Exit(0)
	}
	fmt.Printf(&quot;example for print version&quot;)
}
</code></pre>

<p>构建命令：</p>

<pre><code>go build -ldflags &quot;-X main.version=v0.1&quot; -o example
</code></pre>

<p>程序输出：</p>

<pre><code>➜ ./example
version=v0.1
</code></pre>

<h1 id="参数说明">参数说明</h1>

<p>1、-ldflags build命令中用于调用接链接器的参数</p>

<pre><code>-ldflags '[pattern=]arg list'
	arguments to pass on each go tool link invocation.
</code></pre>

<p>2、-X 链接器参数，主要用于设置变量</p>

<pre><code>-X importpath.name=value
    Set the value of the string variable in importpath named name to value.
    Note that before Go 1.5 this option took two separate arguments.
    Now it takes one argument split on the first = sign.
</code></pre>

<h1 id="一个完整的例子">一个完整的例子</h1>

<p>这里将version包单独做了一个包存放，只需要引入即可：</p>

<pre><code>package main

import (
	&quot;flag&quot;

	&quot;github.com/go-demo/version&quot;
)

//通过flag包设置-version参数
var printVersion bool

func init() {
	flag.BoolVar(&amp;printVersion, &quot;version&quot;, false, &quot;print program build version&quot;)
	flag.Parse()
}

func main() {
	if printVersion {
		version.PrintVersion()
	}
}
</code></pre>

<p>构建的shell如下(也可以放在Makefile中)：</p>

<pre><code>#!/bin/sh
version=&quot;v0.1&quot;
path=&quot;github.com/go-demo/version&quot;
flags=&quot;-X $path.Version=$version -X '$path.GoVersion=$(go version)' -X '$path.BuildTime=`date +&quot;%Y-%m-%d %H:%m:%S&quot;`' -X $path.GitCommit=`git rev-parse HEAD`&quot;
go build -ldflags &quot;$flags&quot; -o example example-version.go
</code></pre>

<p>TIPS: 如果值内容中含有空格，可以用单引号</p>

<p>最终版本输出:</p>

<pre><code>➜ sh build.sh
➜ ./example -version
Version: v0.1
Go Version: go version go1.13.1 darwin/amd64
Git Commit: a775ecd27c5e78437b605c438905e9cc888fbc1c
Build Time: 2020-01-09 19:01:51
</code></pre>

<p>完整代码：<a href="https://github.com/go-demo/version">https://github.com/go-demo/version</a></p>

<blockquote>
<p>关注《学点程序》公众号，了解更多Go相关技术！  <img src="https://image-static.segmentfault.com/125/953/1259530967-5e172702bcedd_articlex" alt="学点程序" /></p>
</blockquote>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/blog/201910/kubernetes-log/" data-toggle="tooltip" data-placement="top" title="Kubernetes容器日志收集方案">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/blog/202002/kubernetes-leaderelection/" data-toggle="tooltip" data-placement="top" title="利用Kubernetes中的leaderelection实现组件高可用？">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            
<div id="disqus-comment"></div>

<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "silenceper" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                    
                    
                       
                    
                       
                    
                       
                    
                       
                    
                       
                    
                       
                    
                       
                            <a href="/tags/flannel" title="flannel">
                                flannel
                            </a>
                       
                    
                       
                            <a href="/tags/go" title="go">
                                go
                            </a>
                       
                    
                       
                            <a href="/tags/k8s" title="k8s">
                                k8s
                            </a>
                       
                    
                       
                    
                       
                    
                       
                    
                       
                    
                       
                    
                       
                            <a href="/tags/wechat" title="wechat">
                                wechat
                            </a>
                       
                    
                    </div>
                </section>

                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                        <li><a target="_blank" href=""></a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="silenceper" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:silenceper@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    

                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/silenceper">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; silenceper , 2020
                    <br>
                    Hugo Theme by <a href="https://github.com/zhaohuabing/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https'){
       bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else{
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>




<script>
    
    var _baId = '5feaced19c04a59ece51d36906735e70';

    
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-139557989-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</body>
</html>
